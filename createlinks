#!/usr/bin/perl -w

use esmith::Build::CreateLinks qw(:all);

my $event = 'nethserver-shellinabox-update';

# templates to expand
foreach my $event (qw ( 
    nethserver-openssh-save 
    nethserver-openssh-update
    nethserver-shellinabox-update 
    nethserver-shellinabox-save)) {
        templates2events("/etc/sysconfig/shellinaboxd", $event);
        templates2events('/etc/httpd/conf.d/shellinabox.conf', $event);
        templates2events('/etc/rc.d/init.d/shellinaboxd', $event);
        templates2events('/etc/httpd/conf/httpd.conf', $event);
    }

# services to launch on event
foreach my $event (qw ( 
    nethserver-openssh-save 
    nethserver-openssh-update
    nethserver-shellinabox-update 
    nethserver-shellinabox-save)) {
        event_services($event,
            'httpd' => 'reload',
            'shellinaboxd'=> 'restart');
    }

# actions to do
my $event = 'nethserver-shellinabox-update';
event_actions($event, 
             'initialize-default-databases' => '00');

my $event = 'nethserver-shellinabox-save';
event_actions($event,
'runlevel-adjust' => '70',
'firewall-adjust' => '95');

#since we use an User Plugin Tab we need 
#to expand template and restart services
foreach my $event (qw ( user-create user-modify)) {
    templates2events("/etc/httpd/conf.d/shellinabox.conf", $event);
    event_services($event,
                      'httpd' => 'reload');
    }


my $event = 'trusted-networks-modify';
    templates2events("/etc/httpd/conf.d/shellinabox.conf", $event);
